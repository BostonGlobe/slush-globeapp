<!-- analytics -->
<!-- depends on the function loadJS in critical.hbs -->
<script type='text/javascript'>

    (function() {    
        var chartbeat = function() {
            window._sf_startpt=(new Date()).getTime();
            window._sf_async_config={uid:8544,domain:"bostonglobe.com"};
            _sf_async_config.path = location.pathname;

             // Section and Author tagging
            _sf_async_config.sections = "{{copy.chartbeat_section}}";
            _sf_async_config.authors = "infographic";   //used for page type
            

            (function(){
                 function loadChartbeat() {
                 window._sf_endpt=(new Date()).getTime();
                 var e = document.createElement('script');
                 e.setAttribute('language', 'javascript');
                 e.setAttribute('type', 'text/javascript');
                 e.setAttribute('src',
                        (("https:" == document.location.protocol) ? "https://s3.amazonaws.com/" : "http://") + "static.chartbeat.com/js/chartbeat.js");
                 document.body.appendChild(e);
                 }
                 var oldonload = window.onload;
                 window.onload = (typeof window.onload != 'function') ?
                 loadChartbeat : function() { oldonload(); loadChartbeat(); };
            })();
        };

        var google = function() {
            loadJS('//www.google-analytics.com/analytics.js');
        };

        var meter = function() {
            window.methode = {};
            loadJS('https://www.bostonglobe.com/js/metercheck.js', function() {
                var showPaywall = {{copy.paywall}};
                var registrationWallVal= showPaywall ? 'non-exempt' : 'exempt';
                window.bglobe.freeviewMeter.init({pageId : '{{copy.page_id}}' , registrationWall : registrationWallVal, webType : 'app', sectionPath : 'apps', debug:  false });
                
                if(methode.freeviewCount > 5 && showPaywall && window.payTheWall) {
                    payTheWall();
                }
            });
        };

        chartbeat();
        google();
        meter();
    })();

</script>